FROM centos:7

COPY docker-entrypoint.sh docker-health-check.sh /sbin/

COPY named.conf /etc/

RUN yum install bind -y && \
    mkdir -p /var/named/views/ -p && \
    mkdir -p /var/named/zones/ -p && \
    echo "a2V5ICJrZXktbmFtZSIgeyAgIAoJYWxnb3JpdGhtIGtleS1hbGdvcml0aG07CglzZWNyZXQgImtleS12YWx1ZSI7IAp9Owo=" | base64 -d -w0 > /etc/rndc.key && \
    echo "OyAgICAgICBUaGlzIGZpbGUgaG9sZHMgdGhlIGluZm9ybWF0aW9uIG9uIHJvb3QgbmFtZSBzZXJ2ZXJzIG5lZWRlZCB0byAKOyAgICAgICBpbml0aWFsaXplIGNhY2hlIG9mIEludGVybmV0IGRvbWFpbiBuYW1lIHNlcnZlcnMKOyAgICAgICAoZS5nLiByZWZlcmVuY2UgdGhpcyBmaWxlIGluIHRoZSAiY2FjaGUgIC4gIDxmaWxlPiIKOyAgICAgICBjb25maWd1cmF0aW9uIGZpbGUgb2YgQklORCBkb21haW4gbmFtZSBzZXJ2ZXJzKS4gCjsgCjsgICAgICAgVGhpcyBmaWxlIGlzIG1hZGUgYXZhaWxhYmxlIGJ5IEludGVyTklDIAo7ICAgICAgIHVuZGVyIGFub255bW91cyBGVFAgYXMKOyAgICAgICAgICAgZmlsZSAgICAgICAgICAgICAgICAvZG9tYWluL25hbWVkLmNhY2hlIAo7ICAgICAgICAgICBvbiBzZXJ2ZXIgICAgICAgICAgIEZUUC5JTlRFUk5JQy5ORVQKOyAgICAgICAtT1ItICAgICAgICAgICAgICAgICAgICBSUy5JTlRFUk5JQy5ORVQKOyAKOyAgICAgICBsYXN0IHVwZGF0ZTogICAgIE9jdG9iZXIgMjQsIDIwMTcgCjsgICAgICAgcmVsYXRlZCB2ZXJzaW9uIG9mIHJvb3Qgem9uZTogICAgIDIwMTcxMDI0MDAKOyAKOyBGT1JNRVJMWSBOUy5JTlRFUk5JQy5ORVQgCjsKLiAgICAgICAgICAgICAgICAgICAgICAgIDM2MDAwMDAgICAgICBOUyAgICBBLlJPT1QtU0VSVkVSUy5ORVQuCkEuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQSAgICAgMTk4LjQxLjAuNApBLlJPT1QtU0VSVkVSUy5ORVQuICAgICAgMzYwMDAwMCAgICAgIEFBQUEgIDIwMDE6NTAzOmJhM2U6OjI6MzAKOyAKOyBGT1JNRVJMWSBOUzEuSVNJLkVEVSAKOwouICAgICAgICAgICAgICAgICAgICAgICAgMzYwMDAwMCAgICAgIE5TICAgIEIuUk9PVC1TRVJWRVJTLk5FVC4KQi5ST09ULVNFUlZFUlMuTkVULiAgICAgIDM2MDAwMDAgICAgICBBICAgICAxOTkuOS4xNC4yMDEKQi5ST09ULVNFUlZFUlMuTkVULiAgICAgIDM2MDAwMDAgICAgICBBQUFBICAyMDAxOjUwMDoyMDA6OmIKOyAKOyBGT1JNRVJMWSBDLlBTSS5ORVQgCjsKLiAgICAgICAgICAgICAgICAgICAgICAgIDM2MDAwMDAgICAgICBOUyAgICBDLlJPT1QtU0VSVkVSUy5ORVQuCkMuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQSAgICAgMTkyLjMzLjQuMTIKQy5ST09ULVNFUlZFUlMuTkVULiAgICAgIDM2MDAwMDAgICAgICBBQUFBICAyMDAxOjUwMDoyOjpjCjsgCjsgRk9STUVSTFkgVEVSUC5VTUQuRURVIAo7Ci4gICAgICAgICAgICAgICAgICAgICAgICAzNjAwMDAwICAgICAgTlMgICAgRC5ST09ULVNFUlZFUlMuTkVULgpELlJPT1QtU0VSVkVSUy5ORVQuICAgICAgMzYwMDAwMCAgICAgIEEgICAgIDE5OS43LjkxLjEzCkQuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQUFBQSAgMjAwMTo1MDA6MmQ6OmQKOyAKOyBGT1JNRVJMWSBOUy5OQVNBLkdPVgo7Ci4gICAgICAgICAgICAgICAgICAgICAgICAzNjAwMDAwICAgICAgTlMgICAgRS5ST09ULVNFUlZFUlMuTkVULgpFLlJPT1QtU0VSVkVSUy5ORVQuICAgICAgMzYwMDAwMCAgICAgIEEgICAgIDE5Mi4yMDMuMjMwLjEwCkUuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQUFBQSAgMjAwMTo1MDA6YTg6OmUKOyAKOyBGT1JNRVJMWSBOUy5JU0MuT1JHCjsKLiAgICAgICAgICAgICAgICAgICAgICAgIDM2MDAwMDAgICAgICBOUyAgICBGLlJPT1QtU0VSVkVSUy5ORVQuCkYuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQSAgICAgMTkyLjUuNS4yNDEKRi5ST09ULVNFUlZFUlMuTkVULiAgICAgIDM2MDAwMDAgICAgICBBQUFBICAyMDAxOjUwMDoyZjo6Zgo7IAo7IEZPUk1FUkxZIE5TLk5JQy5ERE4uTUlMCjsKLiAgICAgICAgICAgICAgICAgICAgICAgIDM2MDAwMDAgICAgICBOUyAgICBHLlJPT1QtU0VSVkVSUy5ORVQuCkcuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQSAgICAgMTkyLjExMi4zNi40CkcuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQUFBQSAgMjAwMTo1MDA6MTI6OmQwZAo7IAo7IEZPUk1FUkxZIEFPUy5BUkwuQVJNWS5NSUwKOwouICAgICAgICAgICAgICAgICAgICAgICAgMzYwMDAwMCAgICAgIE5TICAgIEguUk9PVC1TRVJWRVJTLk5FVC4KSC5ST09ULVNFUlZFUlMuTkVULiAgICAgIDM2MDAwMDAgICAgICBBICAgICAxOTguOTcuMTkwLjUzCkguUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQUFBQSAgMjAwMTo1MDA6MTo6NTMKOyAKOyBGT1JNRVJMWSBOSUMuTk9SRFUuTkVUCjsKLiAgICAgICAgICAgICAgICAgICAgICAgIDM2MDAwMDAgICAgICBOUyAgICBJLlJPT1QtU0VSVkVSUy5ORVQuCkkuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQSAgICAgMTkyLjM2LjE0OC4xNwpJLlJPT1QtU0VSVkVSUy5ORVQuICAgICAgMzYwMDAwMCAgICAgIEFBQUEgIDIwMDE6N2ZlOjo1Mwo7IAo7IE9QRVJBVEVEIEJZIFZFUklTSUdOLCBJTkMuCjsKLiAgICAgICAgICAgICAgICAgICAgICAgIDM2MDAwMDAgICAgICBOUyAgICBKLlJPT1QtU0VSVkVSUy5ORVQuCkouUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQSAgICAgMTkyLjU4LjEyOC4zMApKLlJPT1QtU0VSVkVSUy5ORVQuICAgICAgMzYwMDAwMCAgICAgIEFBQUEgIDIwMDE6NTAzOmMyNzo6MjozMAo7IAo7IE9QRVJBVEVEIEJZIFJJUEUgTkNDCjsKLiAgICAgICAgICAgICAgICAgICAgICAgIDM2MDAwMDAgICAgICBOUyAgICBLLlJPT1QtU0VSVkVSUy5ORVQuCksuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQSAgICAgMTkzLjAuMTQuMTI5CksuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQUFBQSAgMjAwMTo3ZmQ6OjEKOyAKOyBPUEVSQVRFRCBCWSBJQ0FOTgo7Ci4gICAgICAgICAgICAgICAgICAgICAgICAzNjAwMDAwICAgICAgTlMgICAgTC5ST09ULVNFUlZFUlMuTkVULgpMLlJPT1QtU0VSVkVSUy5ORVQuICAgICAgMzYwMDAwMCAgICAgIEEgICAgIDE5OS43LjgzLjQyCkwuUk9PVC1TRVJWRVJTLk5FVC4gICAgICAzNjAwMDAwICAgICAgQUFBQSAgMjAwMTo1MDA6OWY6OjQyCjsgCjsgT1BFUkFURUQgQlkgV0lERQo7Ci4gICAgICAgICAgICAgICAgICAgICAgICAzNjAwMDAwICAgICAgTlMgICAgTS5ST09ULVNFUlZFUlMuTkVULgpNLlJPT1QtU0VSVkVSUy5ORVQuICAgICAgMzYwMDAwMCAgICAgIEEgICAgIDIwMi4xMi4yNy4zMwpNLlJPT1QtU0VSVkVSUy5ORVQuICAgICAgMzYwMDAwMCAgICAgIEFBQUEgIDIwMDE6ZGMzOjozNQo7IEVuZCBvZiBmaWxl" | base64 -d -w0 > /var/named/named.ca && \
    chown 25:0 -R /var/named/ && \
    chmod +x /sbin/docker-entrypoint.sh && \
    chmod +x /sbin/docker-health-check.sh

ENTRYPOINT [ "/sbin/docker-entrypoint.sh" ]